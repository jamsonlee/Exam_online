<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <!-- jQuery (Bootstrap 的 JavaScript 插件需要引入 jQuery) -->
    <script src="../jquery-3.2.1.js"></script>
    <!-- 包括所有已编译的插件 -->
    <script src="../css/bootstrap.js"></script>
    <meta charset="utf-8">
    <title>在线考试</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 引入 Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="../css/popper.js"></script>
    <!-- HTML5 Shiv 和 Respond.js 用于让 IE8 支持 HTML5元素和媒体查询 -->
    <!-- 注意： 如果通过 file://  引入 Respond.js 文件，则该文件无法起效果 -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body style="">

<div class="col-md-3"></div>
<div class="col-md-6" id="paperArea">
    <button type="button" class="btn btn-default" id="btn">交卷</button>
</div>
<script>
    $(document).ready(function () {

        var examId = getUrlParam('examId');//最新操作，可能出错

        let data = "examId="+examId;
        alert(data);
        let url = "/question/queryByExamId/";//此处未适配
        $.ajax({
            url: url,
            type: "GET",
            data: data,
            datatype:"json",
            success:function (list) {//这里要返回试题列表
                alert("success");
                let insertHtml = "";
                let i =0;
                for(var question of list) {
                    i++;
                    console.log(question);
                    insertHtml += `<p>${i}${question.question}</p><textarea class="form-control" id="${i}"></textarea>`
                }

                $("#paperArea").append(insertHtml);
            },
            error:function (str) {
                alert("出现错误！");
            }
        })
    })
</script>

<script>
    $("#btn").click(function ()  {
        alert("dkk");
        var examId = getUrlParam('examId');
        var content = "";
        var i = 0;
        $("textarea").each(function () {
            alert($(this).val());
           content += $(this).val() + "=::=";
        });
        let data = "examId="+examId+"&content="+content;
        alert(data);
        $.ajax({
            url: "/answersheet/insert2",
            type: "GET",
            datatype:"json",//注意最新方法可能有冲突
            data: data,
            success:function (question) {
                alert("交卷成功！");
                window.location.href="studentGoExam.html";
            },
            error:function (str) {
                alert("出现错误！");
            }
        })
    })
</script>

<script>
    /**
     * 取得url参数
     */
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); // 构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  // 匹配目标参数
        if (r != null) return unescape(r[2]); return null; // 返回参数值
    }
</script>

<script>
    $(document).ready(function () {
        $.ajax({
            url:"http://localhost:8080/flag",
            type:"get",
            success:function(id) {
                alert(id);
            },
            error:function () {
                alert("系统出错！");
            }
        })
    })
</script>


</body>
</html>